<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Sistema de Ponto</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar {
            background: #2c3e50;
            color: white;
            height: 100vh;
            position: fixed;
            width: 250px;
        }
        .main-content {
            margin-left: 250px;
            padding: 20px;
        }
        .nav-link {
            color: #bdc3c7;
            padding: 15px 20px;
            border-left: 4px solid transparent;
        }
        .nav-link:hover, .nav-link.active {
            color: white;
            background: #34495e;
            border-left-color: #3498db;
        }
        .nav-link i {
            width: 20px;
            margin-right: 10px;
        }
        .stats-card {
            border-radius: 10px;
            border: none;
            color: white;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            transition: all 0.3s ease;
        }
        #alert-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
        }
        .badge-admin {
            background: linear-gradient(45deg, #FFD700, #FFA500);
        }
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
        }
        .table th {
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            font-weight: 600;
            color: #495057;
        }
        .table td {
            vertical-align: middle;
        }
        .btn-action {
            padding: 4px 8px;
            margin: 2px;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="p-3">
            <h4><i class="fas fa-crown"></i> Painel Admin</h4>
            <hr>
        </div>
        <nav class="nav flex-column">
            <a class="nav-link" href="#" onclick="showSection('dashboard')">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a class="nav-link active" href="#" onclick="showSection('usuarios')">
                <i class="fas fa-users"></i> Gerenciar Usuários
            </a>
            <a class="nav-link" href="#" onclick="showSection('registros')">
                <i class="fas fa-history"></i> Todos os Registros
            </a>
            <a class="nav-link" href="#" onclick="showSection('relatorios')">
                <i class="fas fa-chart-bar"></i> Relatórios
            </a>
            <hr>
            <a class="nav-link text-danger" href="#" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Sair
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Alert Container -->
        <div id="alert-container"></div>

        <!-- Dashboard Section -->
        <div id="dashboard-section" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-tachometer-alt"></i> Dashboard Administrativo</h2>
                <span id="admin-name" class="text-muted">Carregando...</span>
            </div>

            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card stats-card bg-primary card-hover">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h3 id="total-users">0</h3>
                                    <p class="mb-0">Total Usuários</p>
                                </div>
                                <i class="fas fa-users fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card stats-card bg-success card-hover">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h3 id="total-registros">0</h3>
                                    <p class="mb-0">Total Registros</p>
                                </div>
                                <i class="fas fa-list fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card stats-card bg-warning card-hover">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h3 id="registros-hoje">0</h3>
                                    <p class="mb-0">Registros Hoje</p>
                                </div>
                                <i class="fas fa-calendar-day fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card stats-card bg-info card-hover">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h3 id="admin-users">0</h3>
                                    <p class="mb-0">Administradores</p>
                                </div>
                                <i class="fas fa-crown fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0"><i class="fas fa-bolt"></i> Ações Rápidas</h5>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-success me-2" onclick="showSection('usuarios'); novoUsuario();">
                                <i class="fas fa-user-plus"></i> Novo Usuário
                            </button>
                            <button class="btn btn-primary me-2" onclick="showSection('registros')">
                                <i class="fas fa-search"></i> Ver Registros
                            </button>
                            <button class="btn btn-info" onclick="exportarDados()">
                                <i class="fas fa-download"></i> Exportar Dados
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Usuários Section -->
        <div id="usuarios-section">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-users"></i> Gerenciar Usuários</h2>
                <button class="btn btn-success" onclick="novoUsuario()">
                    <i class="fas fa-user-plus"></i> Novo Usuário
                </button>
            </div>

            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Nome</th>
                                    <th>E-mail</th>
                                    <th>Telefone</th>
                                    <th>Cargo</th>
                                    <th>Status</th>
                                    <th>Cadastro</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="usuarios-body">
                                <!-- Usuários serão carregados aqui -->
                                <tr>
                                    <td colspan="7" class="text-center py-4">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Carregando...</span>
                                        </div>
                                        <p class="mt-2 mb-0">Carregando usuários...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Registros Section -->
        <div id="registros-section" style="display: none;">
            <h2 class="mb-4"><i class="fas fa-history"></i> Todos os Registros</h2>
            
            <div class="card">
                <div class="card-header">
                    <div class="row">
                        <div class="col-md-4">
                            <select class="form-select" id="filter-user">
                                <option value="">Todos os usuários</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <input type="date" class="form-control" id="filter-start">
                        </div>
                        <div class="col-md-3">
                            <input type="date" class="form-control" id="filter-end">
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-primary w-100" onclick="carregarRegistrosAdmin()">
                                <i class="fas fa-filter"></i> Filtrar
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Usuário</th>
                                    <th>Data</th>
                                    <th>Hora Entrada</th>
                                    <th>Hora Saída</th>
                                    <th>Local</th>
                                    <th>Observação</th>
                                    <th>Horas Extras</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="registros-admin-body">
                                <!-- Registros serão carregados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Relatórios Section -->
        <div id="relatorios-section" style="display: none;">
            <h2 class="mb-4"><i class="fas fa-chart-bar"></i> Relatórios</h2>
            <div class="card">
                <div class="card-body">
                    <p class="text-muted">Em desenvolvimento...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Usuário -->
    <div class="modal fade" id="modalUsuario" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalUsuarioTitle">Novo Usuário</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="form-usuario">
                        <input type="hidden" id="usuario-id">
                        <div class="mb-3">
                            <label for="nome" class="form-label">Nome *</label>
                            <input type="text" class="form-control" id="nome" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">E-mail *</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="mb-3">
                            <label for="telefone" class="form-label">Telefone</label>
                            <input type="tel" class="form-control" id="telefone">
                        </div>
                        <div class="mb-3">
                            <label for="cargo" class="form-label">Cargo</label>
                            <input type="text" class="form-control" id="cargo" value="Terceiro">
                        </div>
                        <div class="mb-3">
                            <label for="senha" class="form-label">Senha *</label>
                            <input type="password" class="form-control" id="senha" required minlength="6">
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="is-admin">
                            <label class="form-check-label" for="is-admin">
                                É administrador
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="salvarUsuario()">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ========== FUNÇÕES DO PAINEL ADMIN ==========

        // Verificar autenticação e admin
        document.addEventListener('DOMContentLoaded', function() {
            const usuario = JSON.parse(localStorage.getItem('usuario'));
            if (!usuario || !usuario.isAdmin) {
                window.location.href = 'login';
                return;
            }

            document.getElementById('admin-name').textContent = usuario.nome;
            carregarEstatisticas();
            carregarUsuarios();
        });

        // Funções de navegação
        function showSection(sectionName) {
            // Esconder todas as sections
            document.getElementById('dashboard-section').style.display = 'none';
            document.getElementById('usuarios-section').style.display = 'none';
            document.getElementById('registros-section').style.display = 'none';
            document.getElementById('relatorios-section').style.display = 'none';
            
            // Mostrar section selecionada
            document.getElementById(sectionName + '-section').style.display = 'block';
            
            // Atualizar menu
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Carregar estatísticas do sistema
        async function carregarEstatisticas() {
            try {
                // Simular dados de estatísticas
                document.getElementById('total-users').textContent = '12';
                document.getElementById('admin-users').textContent = '2';
                document.getElementById('total-registros').textContent = '156';
                document.getElementById('registros-hoje').textContent = '8';
            } catch (error) {
                console.error('Erro ao carregar estatísticas:', error);
                showAlert('❌ Erro ao carregar estatísticas', 'danger');
            }
        }

        // Carregar lista de usuários
        async function carregarUsuarios() {
            try {
                // Simular dados de usuários
                const usuarios = [
                    {
                        id: 'user-1',
                        nome: 'João Silva',
                        email: 'joao.silva@empresa.com',
                        telefone: '(11) 99999-1234',
                        cargo: 'Desenvolvedor',
                        isAdmin: false,
                        status: 'ativo',
                        criadoEm: '2023-03-15T10:00:00Z'
                    },
                    {
                        id: 'user-2',
                        nome: 'Maria Santos',
                        email: 'maria.santos@empresa.com',
                        telefone: '(11) 98888-5678',
                        cargo: 'Designer',
                        isAdmin: false,
                        status: 'ativo',
                        criadoEm: '2023-05-22T14:30:00Z'
                    },
                    {
                        id: 'user-3',
                        nome: 'Pedro Oliveira',
                        email: 'pedro.oliveira@empresa.com',
                        telefone: '(11) 97777-9012',
                        cargo: 'Gerente',
                        isAdmin: true,
                        status: 'ativo',
                        criadoEm: '2023-01-10T09:15:00Z'
                    },
                    {
                        id: 'user-4',
                        nome: 'Ana Costa',
                        email: 'ana.costa@empresa.com',
                        telefone: '(11) 96666-3456',
                        cargo: 'Analista',
                        isAdmin: false,
                        status: 'inativo',
                        criadoEm: '2023-07-05T16:45:00Z'
                    },
                    {
                        id: 'user-5',
                        nome: 'Carlos Lima',
                        email: 'carlos.lima@empresa.com',
                        telefone: '(11) 95555-7890',
                        cargo: 'Desenvolvedor',
                        isAdmin: false,
                        status: 'ativo',
                        criadoEm: '2023-09-18T11:20:00Z'
                    }
                ];

                exibirUsuarios(usuarios);
                popularFiltroUsuarios(usuarios);
                
            } catch (error) {
                console.error('Erro ao carregar usuários:', error);
                showAlert('❌ Erro ao carregar usuários', 'danger');
            }
        }

        // Exibir usuários na tabela
        function exibirUsuarios(usuarios) {
            const tbody = document.getElementById('usuarios-body');
            
            if (usuarios.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-4">
                            <i class="fas fa-users fa-2x text-muted mb-3"></i>
                            <p class="text-muted mb-0">Nenhum usuário cadastrado</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = usuarios.map(usuario => `
                <tr>
                    <td>
                        <strong>${usuario.nome}</strong>
                        ${usuario.isAdmin ? '<span class="badge badge-admin ms-1">Admin</span>' : ''}
                    </td>
                    <td>${usuario.email}</td>
                    <td>${usuario.telefone || '-'}</td>
                    <td>${usuario.cargo}</td>
                    <td>
                        <span class="badge ${usuario.status === 'ativo' ? 'bg-success' : 'bg-secondary'}">
                            ${usuario.status}
                        </span>
                    </td>
                    <td>${new Date(usuario.criadoEm).toLocaleDateString('pt-BR')}</td>
                    <td>
                        <div class="btn-group" role="group">
                            <button class="btn btn-sm btn-outline-primary btn-action" onclick="editarUsuario('${usuario.id}')" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-warning btn-action" onclick="redefinirSenha('${usuario.id}')" title="Redefinir Senha">
                                <i class="fas fa-key"></i>
                            </button>
                            ${!usuario.isAdmin ? `
                                <button class="btn btn-sm btn-outline-danger btn-action" onclick="excluirUsuario('${usuario.id}')" title="Excluir">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Popular filtro de usuários
        function popularFiltroUsuarios(usuarios) {
            const select = document.getElementById('filter-user');
            select.innerHTML = '<option value="">Todos os usuários</option>';
            
            usuarios.forEach(usuario => {
                select.innerHTML += `<option value="${usuario.id}">${usuario.nome}</option>`;
            });
        }

        // Abrir modal para novo usuário
        function novoUsuario() {
            document.getElementById('modalUsuarioTitle').textContent = 'Novo Usuário';
            document.getElementById('form-usuario').reset();
            document.getElementById('usuario-id').value = '';
            document.getElementById('senha').required = true;
            document.getElementById('senha').placeholder = '';
            
            const modal = new bootstrap.Modal(document.getElementById('modalUsuario'));
            modal.show();
        }

        // Editar usuário
        async function editarUsuario(usuarioId) {
            try {
                // Simular busca do usuário
                const usuarios = [
                    {
                        id: 'user-1',
                        nome: 'João Silva',
                        email: 'joao.silva@empresa.com',
                        telefone: '(11) 99999-1234',
                        cargo: 'Desenvolvedor',
                        isAdmin: false
                    },
                    {
                        id: 'user-2', 
                        nome: 'Maria Santos',
                        email: 'maria.santos@empresa.com',
                        telefone: '(11) 98888-5678',
                        cargo: 'Designer',
                        isAdmin: false
                    },
                    {
                        id: 'user-3',
                        nome: 'Pedro Oliveira',
                        email: 'pedro.oliveira@empresa.com',
                        telefone: '(11) 97777-9012',
                        cargo: 'Gerente',
                        isAdmin: true
                    },
                    {
                        id: 'user-4',
                        nome: 'Ana Costa',
                        email: 'ana.costa@empresa.com',
                        telefone: '(11) 96666-3456',
                        cargo: 'Analista',
                        isAdmin: false
                    },
                    {
                        id: 'user-5',
                        nome: 'Carlos Lima',
                        email: 'carlos.lima@empresa.com',
                        telefone: '(11) 95555-7890',
                        cargo: 'Desenvolvedor',
                        isAdmin: false
                    }
                ];
                
                const usuarioEditar = usuarios.find(u => u.id === usuarioId);
                if (usuarioEditar) {
                    document.getElementById('modalUsuarioTitle').textContent = 'Editar Usuário';
                    document.getElementById('usuario-id').value = usuarioEditar.id;
                    document.getElementById('nome').value = usuarioEditar.nome;
                    document.getElementById('email').value = usuarioEditar.email;
                    document.getElementById('telefone').value = usuarioEditar.telefone || '';
                    document.getElementById('cargo').value = usuarioEditar.cargo;
                    document.getElementById('is-admin').checked = usuarioEditar.isAdmin;
                    document.getElementById('senha').required = false;
                    document.getElementById('senha').placeholder = 'Deixe em branco para manter a senha atual';
                    
                    const modal = new bootstrap.Modal(document.getElementById('modalUsuario'));
                    modal.show();
                }
            } catch (error) {
                console.error('Erro ao carregar usuário:', error);
                showAlert('❌ Erro ao carregar usuário', 'danger');
            }
        }

        // Salvar usuário (criar ou editar)
        async function salvarUsuario() {
            try {
                const nome = document.getElementById('nome').value;
                const email = document.getElementById('email').value;
                const usuarioId = document.getElementById('usuario-id').value;

                if (!nome || !email) {
                    showAlert('❌ Nome e e-mail são obrigatórios', 'warning');
                    return;
                }

                if (!usuarioId && !document.getElementById('senha').value) {
                    showAlert('❌ Senha é obrigatória para novo usuário', 'warning');
                    return;
                }

                // Simular sucesso
                showAlert('✅ Usuário salvo com sucesso!', 'success');
                const modal = bootstrap.Modal.getInstance(document.getElementById('modalUsuario'));
                modal.hide();
                
                // Recarregar lista
                setTimeout(() => {
                    carregarUsuarios();
                    carregarEstatisticas();
                }, 1000);

            } catch (error) {
                console.error('Erro ao salvar usuário:', error);
                showAlert('❌ Erro ao salvar usuário', 'danger');
            }
        }

        // Excluir usuário
        async function excluirUsuario(usuarioId) {
            if (!confirm('Tem certeza que deseja excluir este usuário? Esta ação não pode ser desfeita.')) {
                return;
            }

            try {
                // Simular exclusão
                showAlert('✅ Usuário excluído com sucesso!', 'success');
                setTimeout(() => {
                    carregarUsuarios();
                    carregarEstatisticas();
                }, 1000);

            } catch (error) {
                console.error('Erro ao excluir usuário:', error);
                showAlert('❌ Erro ao excluir usuário', 'danger');
            }
        }

        // Redefinir senha do usuário
        async function redefinirSenha(usuarioId) {
            if (!confirm('Deseja redefinir a senha deste usuário? A nova senha será: 123456')) {
                return;
            }

            try {
                // Simular redefinição
                showAlert(`✅ Senha redefinida com sucesso! Nova senha: 123456`, 'success');

            } catch (error) {
                console.error('Erro ao redefinir senha:', error);
                showAlert('❌ Erro ao redefinir senha', 'danger');
            }
        }

        // Carregar registros administrativos
        async function carregarRegistrosAdmin() {
            try {
                // Simular dados de registros
                const registros = [
                    {
                        id: 'reg-1',
                        usuario_nome: 'João Silva',
                        usuario_cargo: 'Desenvolvedor',
                        data: '15/03/2023',
                        hora_entrada: '07:05',
                        hora_saida: '17:10',
                        local: 'Escritório',
                        observacao: 'Reunião com cliente',
                        horas_extras: false
                    },
                    {
                        id: 'reg-2',
                        usuario_nome: 'Maria Santos',
                        usuario_cargo: 'Designer',
                        data: '15/03/2023',
                        hora_entrada: '07:00',
                        hora_saida: '16:55',
                        local: 'Home Office',
                        observacao: '',
                        horas_extras: false
                    }
                ];

                exibirRegistrosAdmin(registros);
            } catch (error) {
                console.error('Erro ao carregar registros:', error);
                showAlert('❌ Erro ao carregar registros', 'danger');
            }
        }

        // Exibir registros administrativos
        function exibirRegistrosAdmin(registros) {
            const tbody = document.getElementById('registros-admin-body');
            
            if (registros.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center text-muted py-4">
                            <i class="fas fa-inbox fa-2x mb-2"></i><br>
                            Nenhum registro encontrado
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = registros.map(registro => `
                <tr>
                    <td>
                        <strong>${registro.usuario_nome}</strong>
                        <br><small class="text-muted">${registro.usuario_cargo}</small>
                    </td>
                    <td>${registro.data}</td>
                    <td>${registro.hora_entrada || '-'}</td>
                    <td>${registro.hora_saida || '-'}</td>
                    <td>${registro.local || '-'}</td>
                    <td>${registro.observacao || '-'}</td>
                    <td>${registro.horas_extras ? '<span class="badge bg-warning">Sim</span>' : 'Não'}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="editarRegistro('${registro.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Editar registro
        async function editarRegistro(registroId) {
            showAlert('ℹ️ Funcionalidade de edição de registro em desenvolvimento', 'info');
        }

        // Exportar dados
        async function exportarDados() {
            showAlert('ℹ️ Funcionalidade de exportação em desenvolvimento', 'info');
        }

        // Funções auxiliares
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alert-container');
            const alertId = 'alert-' + Date.now();
            
            const alertHTML = `
                <div id="${alertId}" class="alert alert-${type} alert-dismissible fade show" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            alertContainer.innerHTML += alertHTML;
            
            setTimeout(() => {
                const alertElement = document.getElementById(alertId);
                if (alertElement) {
                    alertElement.remove();
                }
            }, 5000);
        }

        // Logout
        function logout() {
            localStorage.removeItem('usuario');
            localStorage.removeItem('usuario_id');
            window.location.href = 'login';
        }
    </script>
</body>
</html>